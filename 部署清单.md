# ğŸš€ éƒ¨ç½²æ¸…å• - å¿«é€Ÿå¼€å§‹

## âœ… ç¼–è¯‘çŠ¶æ€

- âœ… **AccessClient** - å·²ç¼–è¯‘å¹¶éƒ¨ç½²åˆ° `TestDeploy/AccessClient/`
- âœ… **ServiceProvider** - å·²ç¼–è¯‘å¹¶éƒ¨ç½²åˆ° `TestDeploy/ServiceProvider/`
- âœ… **é…ç½®æ–‡ä»¶** - å·²æ›´æ–°ï¼ˆSQLéš§é“ï¼šLocalPort 1430 â†’ TargetPort 1433ï¼‰
- âœ… **å¤šä½™æ–‡ä»¶** - å·²ç§»åˆ° `å‚è€ƒä»£ç /` æ–‡ä»¶å¤¹

## ğŸ“¦ éœ€è¦éƒ¨ç½²çš„æ–‡ä»¶

### 1. äº‘æœåŠ¡å™¨ï¼ˆ42.51.41.138ï¼‰

**å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹**ï¼š`TestDeploy/Server/`

```
Server/
â”œâ”€â”€ P2PServer.exe
â”œâ”€â”€ P2PServer.dll
â”œâ”€â”€ P2PServer.pdb
â”œâ”€â”€ P2PServer.deps.json
â”œâ”€â”€ P2PServer.runtimeconfig.json
â”œâ”€â”€ server_config.json      â† é…ç½®æ–‡ä»¶
â””â”€â”€ å¯åŠ¨æœåŠ¡å™¨.bat
```

**è¿è¡Œ**ï¼š
```powershell
cd Server
.\å¯åŠ¨æœåŠ¡å™¨.bat
```

---

### 2. æœåŠ¡æä¾›ç«¯ï¼ˆæœ‰SQL Serverçš„æœºå™¨ï¼‰

**å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹**ï¼š`TestDeploy/ServiceProvider/`

```
ServiceProvider/
â”œâ”€â”€ P2PClient.exe           â† ä¸»ç¨‹åº
â”œâ”€â”€ P2PClient.dll
â”œâ”€â”€ P2PClient.pdb
â”œâ”€â”€ P2PClient.deps.json
â”œâ”€â”€ P2PClient.runtimeconfig.json
â”œâ”€â”€ client_config.json      â† é…ç½®æ–‡ä»¶ï¼ˆPeerID: æœåŠ¡æä¾›ç«¯ï¼‰
â””â”€â”€ å¯åŠ¨æœåŠ¡æä¾›ç«¯.bat
```

**é…ç½®**ï¼š
```json
{
  "PeerID": "æœåŠ¡æä¾›ç«¯",
  "GroupID": "æµ‹è¯•ç»„1",
  "GroupKey": "test123",
  "Servers": ["42.51.41.138"],
  "ServerPort": 8000,
  "PortForwards": []  // æœåŠ¡ç«¯ä¸éœ€è¦é…ç½®
}
```

**è¿è¡Œ**ï¼š
```powershell
cd ServiceProvider
.\å¯åŠ¨æœåŠ¡æä¾›ç«¯.bat
```

---

### 3. è®¿é—®å®¢æˆ·ç«¯ï¼ˆæœ¬åœ°æœºå™¨ - ä½ çš„ç”µè„‘ï¼‰

**å¤åˆ¶æ•´ä¸ªæ–‡ä»¶å¤¹**ï¼š`TestDeploy/AccessClient/`

```
AccessClient/
â”œâ”€â”€ P2PClient.exe           â† ä¸»ç¨‹åº
â”œâ”€â”€ P2PClient.dll
â”œâ”€â”€ P2PClient.pdb
â”œâ”€â”€ P2PClient.deps.json
â”œâ”€â”€ P2PClient.runtimeconfig.json
â”œâ”€â”€ client_config.json      â† é…ç½®æ–‡ä»¶ï¼ˆå«SQLéš§é“é…ç½®ï¼‰
â””â”€â”€ å¯åŠ¨è®¿é—®å®¢æˆ·ç«¯.bat
```

**é…ç½®**ï¼š
```json
{
  "PeerID": "è®¿é—®å®¢æˆ·ç«¯",
  "GroupID": "æµ‹è¯•ç»„1",
  "GroupKey": "test123",
  "Servers": ["42.51.41.138"],
  "ServerPort": 8000,
  "PortForwards": [
    {
      "Name": "SQLéš§é“",
      "LocalPort": 1430,          â† æœ¬åœ°ç›‘å¬ç«¯å£
      "TargetPeerID": "æœåŠ¡æä¾›ç«¯",
      "TargetPort": 1433,         â† SQL Serverç«¯å£
      "Protocol": "TCP"
    }
  ]
}
```

**è¿è¡Œ**ï¼š
```powershell
cd AccessClient
.\å¯åŠ¨è®¿é—®å®¢æˆ·ç«¯.bat
```

---

## ğŸ¯ éƒ¨ç½²é¡ºåº

```
1ï¸âƒ£ äº‘æœåŠ¡å™¨
   å¯åŠ¨ P2PServer
   çœ‹åˆ°ï¼šğŸ“¡ ç›‘å¬ç«¯å£: 8000

2ï¸âƒ£ æœåŠ¡æä¾›ç«¯
   å¯åŠ¨ P2PClientï¼ˆServiceProviderï¼‰
   çœ‹åˆ°ï¼šâœ… å·²æ³¨å†Œåˆ°æœåŠ¡å™¨

3ï¸âƒ£ è®¿é—®å®¢æˆ·ç«¯
   å¯åŠ¨ P2PClientï¼ˆAccessClientï¼‰
   çœ‹åˆ°ï¼š[ç«¯å£è½¬å‘] SQLéš§é“ å·²å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ 1430
       âœ… P2P ç›´è¿æˆåŠŸï¼

4ï¸âƒ£ æµ‹è¯•è¿æ¥
   è¿æ¥å­—ç¬¦ä¸²ï¼šServer=localhost,1430;Database=MyDB;...
```

## ğŸ”§ SQLéš§é“é…ç½®è¯¦æƒ…

### å·¥ä½œåŸç†
```
ä½ çš„åº”ç”¨
  â†“ Server=localhost,1430
AccessClientç›‘å¬1430
  â†“ P2P/ä¸­è½¬
ServiceProvider
  â†“ è½¬å‘åˆ°127.0.0.1:1433
SQL Server
```

### ç«¯å£è¯´æ˜
| ç«¯å£ | ä½ç½® | ç”¨é€” |
|------|------|------|
| 1430 | è®¿é—®å®¢æˆ·ç«¯æœ¬åœ° | SQLä»£ç†ç›‘å¬ï¼ˆä½ è¿æ¥çš„ç«¯å£ï¼‰ |
| 1433 | æœåŠ¡æä¾›ç«¯æœ¬åœ° | SQL ServerçœŸå®ç«¯å£ |
| 8000 | äº‘æœåŠ¡å™¨ | P2Påè°ƒæœåŠ¡å™¨ï¼ˆUDPï¼‰ |

### è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹
```csharp
// C#
string connectionString = 
    "Server=localhost,1430;" +
    "Database=YourDatabase;" +
    "User Id=sa;" +
    "Password=YourPassword;";

// Python
conn_str = "DRIVER={SQL Server};SERVER=localhost,1430;DATABASE=MyDB;UID=sa;PWD=xxx"

// Java
String url = "jdbc:sqlserver://localhost:1430;databaseName=MyDB";
```

## ğŸ“‹ éªŒè¯æ¸…å•

### äº‘æœåŠ¡å™¨æ£€æŸ¥
- [ ] P2PServeræ­£å¸¸è¿è¡Œ
- [ ] çœ‹åˆ° "ğŸ“¡ ç›‘å¬ç«¯å£: 8000"
- [ ] UDP 8000ç«¯å£å·²å¼€æ”¾é˜²ç«å¢™

### æœåŠ¡æä¾›ç«¯æ£€æŸ¥
- [ ] SQL Serveræ­£å¸¸è¿è¡Œï¼ˆ127.0.0.1:1433ï¼‰
- [ ] P2PClientå·²å¯åŠ¨
- [ ] çœ‹åˆ° "âœ… å·²æ³¨å†Œåˆ°æœåŠ¡å™¨"
- [ ] GroupIDå’ŒGroupKeyæ­£ç¡®

### è®¿é—®å®¢æˆ·ç«¯æ£€æŸ¥
- [ ] P2PClientå·²å¯åŠ¨
- [ ] çœ‹åˆ° "[ç«¯å£è½¬å‘] SQLéš§é“ å·²å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ 1430"
- [ ] çœ‹åˆ° "âœ… P2P ç›´è¿æˆåŠŸ" æˆ– "ğŸ”„ æœåŠ¡å™¨ä¸­è½¬"
- [ ] æœ¬åœ°1430ç«¯å£å¯è¿æ¥

### åº”ç”¨è¿æ¥æ£€æŸ¥
- [ ] ä½¿ç”¨ Server=localhost,1430 èƒ½è¿æ¥
- [ ] èƒ½æ‰§è¡ŒæŸ¥è¯¢
- [ ] èƒ½æŸ¥çœ‹æ•°æ®

## ğŸ—‘ï¸ å·²æ¸…ç†çš„æ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶å·²ç§»åˆ° `å‚è€ƒä»£ç /` æ–‡ä»¶å¤¹ï¼ˆä¸éœ€è¦éƒ¨ç½²ï¼‰ï¼š
- âŒ P2PSQLAccessClient.cs
- âŒ P2PSQLServiceProvider.cs
- âŒ P2PSQLTunnel.cs
- âŒ SQLéš§é“éƒ¨ç½²è¯´æ˜.mdï¼ˆå·²è¿‡æ—¶ï¼‰

**åŸå› **ï¼šç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„ `P2PClient.exe` + JSONé…ç½®ï¼Œæ›´çµæ´»æ˜“ç”¨ã€‚

## ğŸ“ æ–‡ä»¶å¤¹ç»“æ„æ€»è§ˆ

```
d:/Ksa_p2pç›´è”/
â”‚
â”œâ”€â”€ TestDeploy/                  â† ğŸ“¦ éƒ¨ç½²æ–‡ä»¶ï¼ˆç”¨è¿™ä¸ªï¼‰
â”‚   â”œâ”€â”€ Server/                  â† äº‘æœåŠ¡å™¨
â”‚   â”œâ”€â”€ AccessClient/            â† è®¿é—®å®¢æˆ·ç«¯
â”‚   â””â”€â”€ ServiceProvider/         â† æœåŠ¡æä¾›ç«¯
â”‚
â”œâ”€â”€ å‚è€ƒä»£ç /                    â† ğŸ“š æ—©æœŸæ–¹æ¡ˆï¼ˆä»…ä¾›å‚è€ƒï¼‰
â”‚   â”œâ”€â”€ P2PSQLAccessClient.cs
â”‚   â”œâ”€â”€ P2PSQLServiceProvider.cs
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ éƒ¨ç½²æ¸…å•.md                  â† ğŸ“‹ æœ¬æ–‡ä»¶
â”œâ”€â”€ TestDeploy/éƒ¨ç½²è¯´æ˜.md       â† ğŸ“– è¯¦ç»†éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ JSONé…ç½®è¯´æ˜_SQLéš§é“.md      â† ğŸ”§ é…ç½®è¯´æ˜
â”œâ”€â”€ é¡¹ç›®æ€»ç»“ä¸å±•æœ›.md            â† ğŸ“Š é¡¹ç›®æ€»ç»“
â””â”€â”€ ç«¯å£é…ç½®è¯´æ˜.md              â† âš™ï¸ ç«¯å£è¯´æ˜
```

## ğŸ¯ å¿«é€Ÿå¼€å§‹å‘½ä»¤

### ç¼–è¯‘ï¼ˆå·²å®Œæˆï¼Œå¯è·³è¿‡ï¼‰
```powershell
cd d:\Ksa_p2pç›´è”
dotnet build -c Release -o TestDeploy/AccessClient
dotnet build -c Release -o TestDeploy/ServiceProvider
```

### éƒ¨ç½²
```powershell
# 1. äº‘æœåŠ¡å™¨
cd TestDeploy\Server
.\å¯åŠ¨æœåŠ¡å™¨.bat

# 2. æœåŠ¡æä¾›ç«¯
cd TestDeploy\ServiceProvider
.\å¯åŠ¨æœåŠ¡æä¾›ç«¯.bat

# 3. è®¿é—®å®¢æˆ·ç«¯
cd TestDeploy\AccessClient
.\å¯åŠ¨è®¿é—®å®¢æˆ·ç«¯.bat
```

### æµ‹è¯•
```powershell
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -ano | findstr :1430

# æµ‹è¯•SQLè¿æ¥
sqlcmd -S localhost,1430 -U sa -P YourPassword
```

## ğŸ“ è·å–å¸®åŠ©

- **è¯¦ç»†éƒ¨ç½²æ­¥éª¤**ï¼š`TestDeploy/éƒ¨ç½²è¯´æ˜.md`
- **é…ç½®ä¿®æ”¹æ–¹æ³•**ï¼š`JSONé…ç½®è¯´æ˜_SQLéš§é“.md`
- **ç«¯å£é…ç½®è¯´æ˜**ï¼š`ç«¯å£é…ç½®è¯´æ˜.md`
- **æ•…éšœæ’æŸ¥**ï¼š`TestDeploy/éƒ¨ç½²è¯´æ˜.md` çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†

## ğŸ” å®‰å…¨æé†’

1. **ä¿®æ”¹é»˜è®¤å¯†é’¥**ï¼š`"GroupKey": "test123"` æ”¹ä¸ºå¼ºå¯†ç 
2. **ä½¿ç”¨ä¸“ç”¨è´¦æˆ·**ï¼šä¸è¦ç”¨saè´¦æˆ·
3. **é™åˆ¶æƒé™**ï¼šåªç»™å¿…è¦çš„æ•°æ®åº“æƒé™
4. **å¯ç”¨åŠ å¯†**ï¼šSQLè¿æ¥å­—ç¬¦ä¸²æ·»åŠ  `Encrypt=true`

---

**å‡†å¤‡å°±ç»ªï¼** æ‰€æœ‰æ–‡ä»¶å·²ç¼–è¯‘å¹¶éƒ¨ç½²åˆ°æ­£ç¡®ä½ç½®ã€‚

ğŸ“¦ **ç›´æ¥å¤åˆ¶ TestDeploy æ–‡ä»¶å¤¹åˆ°å„è‡ªæœºå™¨å³å¯ï¼**

ğŸš€ **å¼€å§‹æµ‹è¯•å§ï¼**
